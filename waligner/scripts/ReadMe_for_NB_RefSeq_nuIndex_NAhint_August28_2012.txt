#About the SEQC Neuroblastoma RefSeq file, giving expression indexes (quasi unique, with hints to treat NA) generated by Magic mapping deposited on SAS September 11, 2012. NB.NCBI.20120911.GeneExpression.RefSeq.quasiUnique.txt Danielle and Jean Thierry-Mieg, NCBI                                                              Questions?       mieg@ncbi.nlm.nih.gov 5-Sep-12
#Table content: This file is similar to the AceView file deposited a week ago. The only difference is that here, we report gene expression measured on the RefSeq transcripts rather than on AceView transcripts. In both cases the genome and multiple transcriptomes are used as targets and compared. Only reads mapping best to the RefSeq transcripts (better than to the genome or to other transcripts, say from AceView) are counted as support for the RefSeq gene. This ensures a higher mapping specificity, as each read was evaluated in many possible positions, spliced or unspliced, and kept only in the targets where the aligned number of matching bases was maximal (and in any event above our usual stringent quality thresholds).
#In the NB project, we mapped 98.85% of the Illumina reads generated at BGI.  1.28% of the aligned reads map to more than one gene/site, from 2 to 9 genes or genomic sites. An additional 1.91% map to a single genomic site, but to two genes in antisense, and cannot be unambiguously attributed to a gene, because the protocol used was non-stranded. However, only 69.5% of the NB reads map to RefSeq: there are altogether 2.04 x 1010 reads and 1.996 terabases of sequence specifically mapped to RefSeq genes, excluding mitochondrial and ribosomal RNA genes, and used to compute this expression index table. Using AceView rather than RefSeq allowed mapping 11.25% more reads to annotated genes, close to twice as much as in the SEQC main project, because the neuroblastoma transcriptome is more complex than the Brain and mixed cultured cells ones.
# Rows: This table includes 25,159 human genes and 92 ERCC sequences, one gene per row. All genes are ‘official' Entrez genes with a GeneID (all but 2 have a single gene ID). The sequences of the gene models used for the mapping are actually the image of the RefSeq on the genome from NCBI build 37.1: mismatches in the RefSeq relative to the genome have been erased, to allow alignment comparisons. The genes are sorted by descending index of expression, taking for each gene its maximal index across all runs and groups in the table. The first numerical column (number 12), called ‘SumOfAllReadsInProject‘ gives the index of the genes computed by summing all mapped reads in all 513 individual runs. To sort using the sum across all runs of all reads mapping in the genes, reorder on the first numerical column, "SumOfAllReadsInProject". In the top of the table, the first numerical line gives the ‘low measurable index’ in the run, defined as the index for which there are as many NA values above than non-NA values below# This line may be useful when addressing the NA calls in this table (see below)
#Columns: ·         For each gene (named in column 1), in a given annotation (column 2, here all Gene_RefSeq), the NCBI GeneID is provided (Column 3).·         The RefSeq transcript ID(s) currently associated to the GeneID are given in column 4 (from Aug 28, 2012 Gene2RefSeq file at NCBI). The genes in this table include 41,616 RefSeq transcripts (35,773 NM, 4,255 NR, 720 XM, 868 XR). 9,288 genes have multiple supporting RefSeq (alternative variants). 3,184 genes have no current associated RefSeq, reflecting the unavoidable lability of gene annotation.·         Then to allow comparison to microarray datasets used in MAQC2, the Agilent probe ID(s) we uniquely re-mapped to the gene in column 1 is provided in column 5: 27,265 probes map to 18,192 RefSeq genes; 6,786 genes have multiple probes.
#·         Col 6 to 9 give the chromosome, strand, and start and end coordinates of the RefSeq gene on the genome. ·         Col 10 gives the descriptive gene title, from Entrez Gene database ·         Col 11 summarizes the object measured (gene name and annotation of origin).
#·         Column 12 is the first numerical column, called 'SumOfAllReadsInProject', it gives the expression index for each gene when adding all reads mapped to the gene in all 123 runs. ·         The following columns show the index of expression of each gene, per each of 513 runs, named by their official identifier (or by their internal identifier Rhs#), then for each of 15 groups, for the 15 individuals with two runs each (NB248, 251, 252-258, 493-498).  Indexes there were computed by adding all reads from the two runs, since the samples were homogeneous. For some analyses, you may want to keep only the15  groups and discard the corresponding 30 individual runs
#NA values:  Genes that are not "significantly expressed", i.e. with less than 4 reads above the experimental noise level, acquire an NA flag. Since it is hard to deal with absent values (e.g. to compute an average or to extract meaningful differentially expressed genes), in this new file, a value is given behind the NA/ as a hint of the unreliably measured index (inaccurate because based on too few counts and dominated by sampling errors), and the ‘low measurable index’ is provided for each run or groups of runs.·         To treat NA, there are three options: o   one may either blank out the absent values identified by NA, o   or take the hint value behind NA (not too seriously), o   or use a common value for NA in each run: we propose to use the number given in the first numerical line of the table, called "Lowest measurable index", minus 1 .
# Thanks to David Kreil, Peter and Pawel from Boku for testing the three methods. The plot below shows the ‘low measurable index’ for all 513 individual runs and 15 + 1 groups in the table. It directly depends on the size of the run, and in this relatively deep experiment (around 59.3 million aligned reads per patient), gene expression can be measured down to index 6.2 on average. If we focus on the 23,663 RefSeq genes expressed in at least one NB sample, 10.3 millions are called expressed while 3.0 million are NA/# calls: close to 23% of the RefSeq calls are NA, ie not significantly expressed or not reliably measurable. 1,496 RefSeq genes in this table are 'not significantly expressed' - or NA - in any of the 513 neuroblastoma runs. The number of genes called expressed at or above a given index is shown here:
# Mapping strategy: We use our Magic RNAseq aligner and pipeline. Read pairs are mapped in parallel on multiple targets, and the quality of the alignments is compared to select the best alignments. All best alignments are then submitted to a stringent quality filter. Specificity of the mapping is monitored using the ‘imaginary genome’, i.e. the genome of the species where all A and T, and all G and C were simply exchanged, making it completely alien, as only short stretches of RNAseq map to this genome, yet respecting letter statistics at all scales. Targets used in this project were the AceView 2010 transcripts, the RefSeq from build 37.1, the genome, the mitochondria, the ribosomal RNAs, the ‘RNA genes’ from S. Eddy, the ERCC and PhiX controls, and the imaginary genome as a mapping specificity control. At the end of the process, all reads are accounted for. Magic alignments on the genome can be discontinuous, allowing for exon-junctions discovery; they may include substitutions, short insertions or deletion#s, but not closer than 8 bases from either end of the read, otherwise the alignment is clipped before the mismatch to avoid extending alignments within introns. The eventual adaptor sequences and poly A tails are trimmed dynamically during the alignment, verifying that the trimmed part does not match the target genome or gene. Finally, the best targets for each read-pair are selected, and only read mapping well and at their best score in the AceView or RefSeq transcripts are used to compute the gene indexes in this table. 
#Genes often have alternative transcripts, to which the reads map equally well; such reads count as uniquely mapped in the gene, and each gene receives the union (not the sum) of all reads mapping to its alternative transcripts. Some reads, usually around 1-2%, map equally well in up to 9 genes: they are attributed to the candidate genes in Bayesian proportion of the number of reads mapping uniquely to these genes. (a similar table limited to uniquely mapping reads, is available on request).  Note that, for equal quality alignments, a slight penalty was given to unspliced genes relative to spliced ones at the best-targets selection step, and this avoids over-annotating recent pseudogenes.
#Normalization: the Magic expression index
#The Magic expression index for the gene is measured as the log base 2 of the number of bases aligned in the gene, divided by the number of terabases aligned in known genes and by the length of the gene, with several corrections. When a gene is reliably measured (i.e. not NA), the index is independent of the size of the experiment; it factors in the quality of the libraries, the insert length and the noise level. Because of the stringent quality filter imposed on the alignments, the noise is mainly genomic contamination, evaluated as the fraction of truly intergenic reads after transcriptome reconstruction. Our index is directly comparable to a normalized microarray logarithmic luminosity. 
#Genes that are not "significantly expressed", i.e. with less than 4 reads above the experimental noise level, acquire an NA/ flag. For significantly expressed genes, the expression index is measured as Index = log2 (z+ sqrt(1+z^2))-1, with z = 10^12 n/N'l'
# z estimates the coverage of the gene per terabases aligned,  n is the number of bases aligned in the gene,  N' /10^12 is the corrected number of terabases aligned to the AceView genes with GeneID, after excluding the ribosomal and mitochondrial genes and the genes gathering more than 2% of the total number of bases aligned (in rat liver TGx, often the genes Alb, Ehhadh, Trf), to compensate an apparent variation of all indexes in the presence of highly-variable extremely-expressed genes.  l' is the length of the gene effectively sequenceable in the particular experiment, which is limited in polyA selected libraries by the maximal length of the cDNA synthesis, and constrained by the insert length: genes shorter than insert size cannot be sequenced. In practice, the coverage of very long ubiquitous genes (such as EEF2 (3.5kb), FLNA (8.5 kb), MALAT1 (7kb), AHNAK (18 kb) or NEAT (22 kb)) is measured and used as a maximal gene length. 
#This length is usually below 3 kb for a polyA selection protocol; it corresponsmainly to the 3' bias. Second, the average length lambda of the insert is measured by aligning the read pairs, and subtracted from the length of the main RNA l. Indeed l'= (l – lambda) is the number of possible positions of the insert in the gene; l' is set to at least lambda. This correction matters for short genes, under-represented in libraries with long insert size.
